{% extends 'base.html' %}
{% load static %}

{% block styles %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
<script src="https://kit.fontawesome.com/a0d321d495.js" crossorigin="anonymous"></script>
<link href="{% static 'css/m_myreports.css' %}" rel="stylesheet">

<link href="{% static 'css/user_account.css' %}" rel="stylesheet"> 
<link href=" {% static 'css/profile.css' %} " rel="stylesheet">

{% endblock styles %}



{% block content %}


<!-- Page Wrapper -->

{% include 'includes/sa_sidebar.html' %}
    


    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            {% include 'includes/navbar.html' %}



           <!-- ===== MAIN CONTENT  ===== -->
           <div class="container-fluid">

            <!-- Generate Buttons -->
            <div class="d-flex bd-highlight">
                <div class="pg-title p-2 flex-grow-1 bd-highlight">
                    <h4>Reports</h4>
                </div>
            </div>

            <div class="row">
            
                <form id="form1" action="{% url 'sa_reportslist' %}" enctype="multipart/form-data" method="post">
                    {% csrf_token %}
                    
                    {% if incidentReports %}
                    
        {% comment %} <div class="modal-footer">
            <a href="{% url 'sa_recycle_bin'%}" title ="Recycle Bin"
            class="btn btn-sm btn-success">Recycle Bin</a>
            <a href="#" class="btn btn-sm btn-danger" data-toggle="modal" data-target="#bulkdeleteModal">Bulk Delete</a>
    </div>
                {% endcomment %}
                <div class="col-12">
                    <div class="tab-content" id="nav-tabContent">
                        <table class="table table-bordered table-hover text-dark" id="user_report" width="100%"
                        style="cursor: pointer;" cellspacing="0">         
    <thead>
        <tr>
            {% comment %} <th></th> {% endcomment %}
            <th>Username</th>
            <th>Date</th>
            <th>Time</th>
            <th>Description</th>
            <th>Location</th>
            {% comment %} <th>Accident Factor</th>
            <th>Collision Type</th> {% endcomment %}
            <th>Accident Factor</th>
            <th>Collision Type</th>
            <th>Crash Type</th>
            <th>Status</th>
            <th>Settings</th>
        </tr>
    </thead>

    <tbody>
    <div class="container" id="accordion">
        <div class="card">
            
            {% for post in incidentReports %}

            
                <tr>
                   
                    {% comment %} {% if post.status == 1 %}
                    <td>
                      
                    </td>
                    {% else %}
                    <td><input type="checkbox" name="{{post.id}}" id="check"></td>
                    {% endif %} {% endcomment %}
                               
                                <td>{{post.user.username}}</td>
                                <td>{{post.date}}</td>
                                <td>{{post.time}}</td>
                                <td>{{post.description}}</td>
                                <td>{{post.address}}</td>
                                <td>{{post.accident_factor}}</td>
                                <td>{{post.collision_type}}</td>
                                <td>{{post.crash_type}}</td>
                                {% comment %} <td>{{incident__incident_general.accident_factor}}</td>
                                <td>{{incident.collision_type}}</td> {% endcomment %}
                                
                                <td>
                                    {% if post.status == 1 %}
                                    <span class="badge badge-warning">{{post.get_status}}</span>
                                    {% elif post.status == 2 %}
                                    <span class="badge badge-success">{{post.get_status}}</span>
                                    {% elif post.status == 3 %}
                                    <span class="badge badge-danger">{{post.get_status}}</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{% url 'incident_report_general_view' post.id %}"><i class='bx bxs-folder-open'
                                        title="View"></i></a>
           
                                        {% if post.status == 2 %} 
                                        {% else %}     
                                        <a href="#" data-toggle="modal" data-target="#deleteModal{{ post.id }}"><i class='bx bx-trash'
                                            data-toggle="tooltip" title="Delete" ></i></a>
                                            {% endif %}
                                            
                                            
                                        
                                </td>
                                {% comment %} <td>
                                    <a href="#"  data-toggle="collapse"
                                            data-target="#collapse{{post.id}}" onclick=""><i class="fa-sharp fa-solid fa-caret-down"></i></a>
                                </td> {% endcomment %}
                                

                   
                </tr>

                <tr>
                    <td id="collapse{{post.id}}" class="collapse" colspan="10" >

                        <div class="columns is-mobile is-centered">
                            <div class="column is-half">
                                <ul class="timeline">
                          {% for notification in notifications %}

                          {% if notification.incident_report.id == post.id %}
                         
                         
                          {% if notification.remarks == "new incident" %}

                         
                            <li class="timeline-item mb-5">
                            
                              <p class="text-muted mb-2 fw-bold">{{ notification.date}}</p>
                              <p class="text-muted">
                                {{ notification.sender.first_name }} {{ notification.sender.last_name }} &lt;{{ notification.sender.username }}&gt; sent an incident report
                              </p>
                            </li>

                          
                         
                          
                            {% endif %}
                          
                            {% if notification.remarks == "update remarks status" and post.responder != None %}

                            <li class="timeline-item mb-5">
                              
                              <p class="text-muted mb-2 fw-bold">{{ notification.date}}</p>
                              <p class="text-muted">
                              
                                {{ notification.user.first_name }} {{ notification.user.last_name }} &lt;{{ notification.user.username }}&gt; {{notification.text_preview}} {{notification.responder.username}}
                                  
                             
                              </p>
                            </li>

                            {% endif %}

                            {% comment %} {% if notification.remarks == "update action status" and incident.action_taken != "" %}

                          <li class="timeline-item mb-5">
                            
                            <p class="text-muted mb-2 fw-bold">{{ notification.date}}</p>
                            <p class="text-muted">
                            
                                {{ notification.user.first_name }} {{ notification.user.last_name }} &lt;{{ notification.user.username }}&gt; The incident report (ref# incident{{incident.incident_general.id}}) was 
                                <strong>{{ incident.action_taken }} </strong>
                           
                            </p>
                          </li>

                          {% endif %}

                          {% if notification.remarks == "update incident location status" and incident.incident_location != "" %}

                          <li class="timeline-item mb-5">
                            
                            <p class="text-muted mb-2 fw-bold">{{ notification.date}}</p>
                            <p class="text-muted">
                            
                                {{ notification.user.first_name }} {{ notification.user.last_name }} &lt;{{ notification.user.username }}&gt; 
                                <strong>{{ notification.text_preview }} </strong>
                           
                            </p>
                          </li>

                          {% endif %} {% endcomment %}
                          
                          {% if notification.remarks == "update incident status" %}

                          <li class="timeline-item mb-5">
                            
                            <p class="text-muted mb-2 fw-bold">{{ notification.date}}</p>
                            <p class="text-muted">
                                {% if notification.text_preview == "updated status to approved" %}
                                {{ notification.user.first_name }} {{ notification.user.last_name }} &lt;{{ notification.user.username }}&gt; <strong> {{ notification.text_preview }} </strong> and completed the report
                                information  of the incident report (ref# incident{{incident.incident_general.id}})
                                {% else %}
                                {{ notification.user.first_name }} {{ notification.user.last_name }} &lt;{{ notification.user.username }}&gt; <strong> {{ notification.text_preview }} </strong>
                                {% endif %}
                            </p>
                          </li>

                          
                            {% endif %}

            
                        
                            {% endif %}
                          {% endfor %}
                        </ul>
                          </div>
                          </div>
                          </div>
                    </td>
                </tr>
                <div class="modal fade" id="deleteModal{{ incident.id }}" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel"><i class="fas fa-trash-alt"></i>&nbsp;&nbsp; Delete Incident</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                    </button>
                            </div>
                            <div class="modal-body text-center">
                                <div class="text-center text-danger"><i class="far fa-times-circle fa-5x mb-4 mt-2"></i></div>
                                <div class="text-center text-danger">
                                    <span>Do you want to delete this incident report?</span>
                                    {% comment %} <div class="text-dark mt-3 mb-2">Customer: <strong>{{users.username}}</strong></div> {% endcomment %}
                                </div>
                        </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                
                    
                        
                                    <a class="btn btn-sm btn-danger" href="{% url 'user_reports_delete' post.id %}">Delete</a>
                            
                                </div>
                        </div>
                    </div>
                </div>

                <!-- BULK Delete Modal HTML -->
                {% include 'modals/bulkdelete.html' %}    


                
            
        </div>
     {% endfor %}
          
        </div>
    </div>
    </tbody>
</table>

{% else %}

<h5 class="text-center">No User Report Added.</h5>
     
{% endif %}

</form>
                    </div>
                 </div>
            
           
            


        </div>
    </div>    <!-- End of Main Content  -->

    </div>
        <!-- Scroll to Top-->
        <a class="scroll-to-top rounded" href="#scroll-up">
            <i class='bx bxs-up-arrow'></i>
        </a>
        <!-- End of Scroll to Top-->

{% comment %} {% include 'includes/alerts_frame.html' %} {% endcomment %}

{% endblock %}

{% block scripts %}
<!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
{% endblock scripts %}